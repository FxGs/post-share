<!DOCTYPE html>
<html>
  <head>
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://kit.fontawesome.com/59ef493f57.js"
      crossorigin="anonymous"
    ></script>
    <title>new post</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css"
    />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Amiri&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="/stylesheets/boiler.css" />
  </head>
  <body
    class="has-navbar-fixed-top is-flex is-flex-direction-column is-size-6 is-size-7-mobile"
    style="height: 100vh"
  >
    <%-include('../partials/newmodal')%> <%-include('../partials/navbar')%>
    <section>
      <main class="container" style="margin-top: 3rem">
        <div class="columns is-mobile is-centered">
          <div
            class="column is-three-quarters-mobile is-three-quarters-tablet is-half-desktop"
          >
            <div class="box">
              <h1 class="title">Edit Post</h1>
              <form
              action="/posts/<%=post.id%>?_method=PUT"
              method="POST"
              enctype="multipart/form-data"
              >
                <div class="field">
                  <label for="author" class="label">Author</label>
                  <div class="control has-icons-right">
                    <input
                      class="input is-success edit-author"
                      type="text"
                      id="author"
                      name="post[author]"
                      value="<%=post.author%>"
                      required
                    />
                    <span class="icon is-small is-right" >
                      <i class="fas fa-check" id="editauthorSuccessIcon" style="display: block;"></i>
                    </span>
                    <span class="icon is-small is-right">
                      <i class="fas fa-exclamation-triangle" id="editauthorErrorIcon" style="display: none;"></i>
                    </span>
                    <p id="editauthor_error" class="help is-error" style="display: none; font-family: 'Courier New', Courier, monospace; font-size: medium;">Just tell your name</p>
                  </div>
                </div>
                <div class="field">
                  <label for="title" class="label">Title</label>
                  <div class="control has-icons-right">
                    <input
                      class="input is-success edit-title"
                      type="text"
                      id="title"
                      name="post[title]"
                      value="<%=post.title%>"
                      required
                    />
                    <span class="icon is-small is-right" >
                      <i class="fas fa-check" id="edittitleSuccessIcon" style="display: block;"></i>
                    </span>
                    <span class="icon is-small is-right">
                      <i class="fas fa-exclamation-triangle" id="edittitleErrorIcon" style="display: none;"></i>
                    </span>
                    <p id="edittitle_error" class="help is-error" style="display: none; font-family: 'Courier New', Courier, monospace; font-size: medium;">Give a nice title to your post</p>
                  </div>
                </div>
                <div class="field">
                  <div id="file-edit" class="file has-name is-fullwidth">
                    <label class="file-label">
                      <input
                        class="file-input"
                        type="file"
                        name="image"
                        multiple
                      />
                      <span class="file-cta">
                        <span class="file-icon">
                          <i class="fas fa-upload"></i>
                        </span>
                        <span class="file-label"> Add new images... </span>
                      </span>
                      <span class="file-name"></span>
                    </label>
                  </div>
                </div>
                <div class="field">
                  <label for="body" class="label">body</label>
                  <div class="control has-icons-right">
                    <textarea
                      class="textarea is-success edit-area"
                      rows="5"
                      id="body"
                      name="post[body]"
                      required
                    ><%=post.body%>
                  </textarea>
                  <span class="icon is-small is-right" >
                    <i class="fas fa-check" id="editbodySuccessIcon" style="display: block;"></i>
                  </span>
                  <span class="icon is-small is-right">
                    <i class="fas fa-exclamation-triangle" id="editbodyErrorIcon" style="display: none;"></i>
                  </span>
                  <p id="editbody_error" class="help is-error" style="display: none; font-family: 'Courier New', Courier, monospace; font-size: medium;">a post without body is nonsense</p>
                  </div>
                </div>

                <% post.image.forEach(function(img, i) { %>
                <div class="field is-grouped">
                  <div class="control">
                    <figure class="image is-96x96">
                      <img
                        src="<%=img.url%>"
                        alt=""
                        style="width: 96px; height: 96px"
                      />
                    </figure>
                  </div>
                  <div class="control">
                    <input
                      type="checkbox"
                      id="image-<%=i%>"
                      name="deleteImages[]"
                      value="<%=img.filename%>"
                    />
                    <label for="image-<%=i%>">Delete</label>
                  </div>
                </div>
                <% }) %>
                <div class="field is-grouped is-grouped-right">
                  <div class="control">
                    <button id="Edit-Btn" type="submit" class="button is-primary">
                      save changes
                    </button>
                    <button class="button is-light" href="/posts/<%=post.id%>">
                      cancel
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </main>
    </section>
    <%-include('../partials/footer')%>
  </body>
  <script src="/scripts/navbar.js"></script>
  <script src="/scripts/modal.js"></script>
  <script>
    const fileInput2 = document.querySelector("#file-edit input[type=file]");
    fileInput2.onchange = () => {
      if (fileInput2.files.length > 0) {
        const fileName2 = document.querySelector("#file-edit .file-name");
        fileName2.textContent = fileInput2.files[0].name;
      }
    };
  </script>
  <script src="/scripts/form-validation.js"></script>
  <script src="/scripts/edit-validation.js"></script>
</html>
